11587d23fdfb94a117d7ac231989136a
"use strict";

_getJestObj().mock('Api/notifications.service', function () {
  return {
    setSeenNotifications: jest.fn(),
    getNotifications: jest.fn()
  };
});

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _react = _interopRequireDefault(require("react"));

var _react2 = require("@testing-library/react");

var _reactRedux = require("react-redux");

var _faker = _interopRequireDefault(require("faker"));

var _NotificationMenu = _interopRequireDefault(require("Components/NotificationMenu"));

var _notifications = _interopRequireDefault(require("Api/notifications.service"));

var _logUser = _interopRequireDefault(require("Reducers/logUser"));

var _toolkit = require("@reduxjs/toolkit");

var _redux = require("redux");

var _luxon = require("luxon");

function _getJestObj() {
  var _require = require("@jest/globals"),
      jest = _require.jest;

  _getJestObj = function _getJestObj() {
    return jest;
  };

  return jest;
}

function renderWithProviders(ui, reduxState) {
  var initialState = {
    logUser: {
      data: {
        documentNumber: '232323'
      },
      loggedIn: false
    },
    userNotifications: {
      notifications: []
    }
  };
  var rootReducer = (0, _toolkit.combineReducers)({
    logUser: _logUser["default"],
    userNotifications: _logUser["default"]
  });
  var store = (0, _redux.createStore)(rootReducer, reduxState || initialState);
  return (0, _react2.render)( /*#__PURE__*/_react["default"].createElement(_reactRedux.Provider, {
    store: store
  }, ui));
}

describe('Notification Menu Empty', function () {
  test('Has notification button', function () {
    renderWithProviders( /*#__PURE__*/_react["default"].createElement(_NotificationMenu["default"], null));
    expect(document.getElementById('noty-stack')).toBeInTheDocument();
  });
  test('Opens Dropdown', function () {
    var _renderWithProviders = renderWithProviders( /*#__PURE__*/_react["default"].createElement(_NotificationMenu["default"], null)),
        getByText = _renderWithProviders.getByText;

    _react2.fireEvent.click(document.getElementById('noty-stack'));

    expect(getByText('Notificaciones')).toBeInTheDocument();
  });
  test('No notifications', function () {
    var _renderWithProviders2 = renderWithProviders( /*#__PURE__*/_react["default"].createElement(_NotificationMenu["default"], null)),
        getAllByText = _renderWithProviders2.getAllByText;

    _react2.fireEvent.click(document.getElementById('noty-stack'));

    expect(getAllByText(/No hay notificaciones/i)).toHaveLength(2);
  });
});
var state = {
  logUser: {
    data: {
      documentNumber: '232323'
    },
    loggedIn: false
  },
  userNotifications: {
    notifications: [{
      id: 1,
      title: 'Una notificacion',
      body: 'notificacion',
      status: 'not_seen',
      createdAt: _faker["default"].date.past()
    }]
  }
};
describe('Notification Menu Only New', function () {
  test('No seen notifications', function () {
    var _renderWithProviders3 = renderWithProviders( /*#__PURE__*/_react["default"].createElement(_NotificationMenu["default"], null), state),
        getAllByText = _renderWithProviders3.getAllByText;

    _react2.fireEvent.click(document.getElementById('noty-stack'));

    expect(getAllByText(/No hay notificaciones/i)).toHaveLength(1);
  });
  test('New notifications', function () {
    var _renderWithProviders4 = renderWithProviders( /*#__PURE__*/_react["default"].createElement(_NotificationMenu["default"], null), state),
        getByText = _renderWithProviders4.getByText;

    _react2.fireEvent.click(document.getElementById('noty-stack'));

    expect(getByText(/Una notificacion/i)).toBeInTheDocument();
  });
  test('View History', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee() {
    var _yield$renderWithProv, getByText;

    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _notifications["default"].getNotifications.mockImplementation(function () {
              return {
                status: 200,
                data: {
                  notifications: [{
                    id: 2,
                    title: 'Historia',
                    body: 'notificacion',
                    status: 'seen',
                    createdAt: _luxon.DateTime.local().minus({
                      day: 1
                    }).toISO()
                  }]
                }
              };
            });

            _context.next = 3;
            return renderWithProviders( /*#__PURE__*/_react["default"].createElement(_NotificationMenu["default"], null), state);

          case 3:
            _yield$renderWithProv = _context.sent;
            getByText = _yield$renderWithProv.getByText;

            _react2.fireEvent.click(document.getElementById('noty-stack'));

            _react2.fireEvent.click(getByText(/Ver todas/i));

            _context.next = 9;
            return (0, _react2.waitFor)(function () {
              expect(getByText(/Historia/i)).toBeInTheDocument();
            });

          case 9:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  })));
  test('View History And Close', /*#__PURE__*/(0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
    var _yield$renderWithProv2, getByText, queryByText;

    return _regenerator["default"].wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _notifications["default"].getNotifications.mockImplementation(function () {
              return {
                status: 200,
                data: {
                  notifications: [{
                    id: 2,
                    title: 'Historia',
                    body: 'notificacion',
                    status: 'seen',
                    createdAt: _luxon.DateTime.local().toISO()
                  }]
                }
              };
            });

            _context2.next = 3;
            return renderWithProviders( /*#__PURE__*/_react["default"].createElement(_NotificationMenu["default"], null), state);

          case 3:
            _yield$renderWithProv2 = _context2.sent;
            getByText = _yield$renderWithProv2.getByText;
            queryByText = _yield$renderWithProv2.queryByText;

            _react2.fireEvent.click(document.getElementById('noty-stack'));

            _react2.fireEvent.click(getByText(/Ver todas/i));

            _context2.next = 10;
            return (0, _react2.waitFor)(function () {
              expect(getByText(/Historia/i)).toBeInTheDocument();
            });

          case 10:
            _react2.fireEvent.click(getByText(/Esconder/i));

            _context2.next = 13;
            return (0, _react2.waitFor)(function () {
              expect(queryByText(/Historia/i)).toBeNull();
            });

          case 13:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  })));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5vdGlmaWNhdGlvbk1lbnUudGVzdC5qcyJdLCJuYW1lcyI6WyJtb2NrIiwic2V0U2Vlbk5vdGlmaWNhdGlvbnMiLCJqZXN0IiwiZm4iLCJnZXROb3RpZmljYXRpb25zIiwicmVuZGVyV2l0aFByb3ZpZGVycyIsInVpIiwicmVkdXhTdGF0ZSIsImluaXRpYWxTdGF0ZSIsImxvZ1VzZXIiLCJkYXRhIiwiZG9jdW1lbnROdW1iZXIiLCJsb2dnZWRJbiIsInVzZXJOb3RpZmljYXRpb25zIiwibm90aWZpY2F0aW9ucyIsInJvb3RSZWR1Y2VyIiwic3RvcmUiLCJkZXNjcmliZSIsInRlc3QiLCJleHBlY3QiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwidG9CZUluVGhlRG9jdW1lbnQiLCJnZXRCeVRleHQiLCJmaXJlRXZlbnQiLCJjbGljayIsImdldEFsbEJ5VGV4dCIsInRvSGF2ZUxlbmd0aCIsInN0YXRlIiwiaWQiLCJ0aXRsZSIsImJvZHkiLCJzdGF0dXMiLCJjcmVhdGVkQXQiLCJmYWtlciIsImRhdGUiLCJwYXN0Iiwibm90aWZpY2F0aW9uc1NlcnZpY2UiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJEYXRlVGltZSIsImxvY2FsIiwibWludXMiLCJkYXkiLCJ0b0lTTyIsInF1ZXJ5QnlUZXh0IiwidG9CZU51bGwiXSwibWFwcGluZ3MiOiI7O0FBOEJBLGNBQUtBLElBQUwsQ0FBVSwyQkFBVixFQUF1QztBQUFBLFNBQU87QUFDNUNDLElBQUFBLG9CQUFvQixFQUFFQyxJQUFJLENBQUNDLEVBQUwsRUFEc0I7QUFFNUNDLElBQUFBLGdCQUFnQixFQUFFRixJQUFJLENBQUNDLEVBQUw7QUFGMEIsR0FBUDtBQUFBLENBQXZDOzs7Ozs7OztBQTlCQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7OztBQUVBLFNBQVNFLG1CQUFULENBQTZCQyxFQUE3QixFQUFpQ0MsVUFBakMsRUFBNkM7QUFD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VixDQUFnQkYsU0FBUyxDQUFDLFlBQUQsQ0FBekI7O0FBakI2QjtBQUFBLG1CQWtCdkIscUJBQVEsWUFBTTtBQUNsQkosY0FBQUEsTUFBTSxDQUFDSSxTQUFTLENBQUMsV0FBRCxDQUFWLENBQU4sQ0FBK0JELGlCQUEvQjtBQUNELGFBRkssQ0FsQnVCOztBQUFBO0FBcUI3QkUsOEJBQVVDLEtBQVYsQ0FBZ0JGLFNBQVMsQ0FBQyxXQUFELENBQXpCOztBQXJCNkI7QUFBQSxtQkFzQnZCLHFCQUFRLFlBQU07QUFDbEJKLGNBQUFBLE1BQU0sQ0FBQ3lCLFdBQVcsQ0FBQyxXQUFELENBQVosQ0FBTixDQUFpQ0MsUUFBakM7QUFDRCxhQUZLLENBdEJ1Qjs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxHQUEzQixHQUFKO0FBMEJELENBOURPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgcmVuZGVyLCBmaXJlRXZlbnQsIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcbmltcG9ydCB7IFByb3ZpZGVyIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IGZha2VyIGZyb20gJ2Zha2VyJztcbmltcG9ydCBOb3RpZmljYXRpb25NZW51IGZyb20gJ0NvbXBvbmVudHMvTm90aWZpY2F0aW9uTWVudSc7XG5pbXBvcnQgbm90aWZpY2F0aW9uc1NlcnZpY2UgZnJvbSAnQXBpL25vdGlmaWNhdGlvbnMuc2VydmljZSc7XG5pbXBvcnQgbG9nVXNlciBmcm9tICdSZWR1Y2Vycy9sb2dVc2VyJztcbmltcG9ydCB1c2VyTm90aWZpY2F0aW9ucyBmcm9tICdSZWR1Y2Vycy9sb2dVc2VyJztcbmltcG9ydCB7IGNvbWJpbmVSZWR1Y2VycyB9IGZyb20gJ0ByZWR1eGpzL3Rvb2xraXQnO1xuaW1wb3J0IHsgY3JlYXRlU3RvcmUgfSBmcm9tICdyZWR1eCc7XG5pbXBvcnQgeyBEYXRlVGltZSB9IGZyb20gJ2x1eG9uJztcblxuZnVuY3Rpb24gcmVuZGVyV2l0aFByb3ZpZGVycyh1aSwgcmVkdXhTdGF0ZSkge1xuICBjb25zdCBpbml0aWFsU3RhdGUgPSB7XG4gICAgbG9nVXNlcjoge1xuICAgICAgZGF0YTogeyBkb2N1bWVudE51bWJlcjogJzIzMjMyMycgfSxcbiAgICAgIGxvZ2dlZEluOiBmYWxzZSxcbiAgICB9LFxuICAgIHVzZXJOb3RpZmljYXRpb25zOiB7XG4gICAgICBub3RpZmljYXRpb25zOiBbXSxcbiAgICB9LFxuICB9O1xuICBjb25zdCByb290UmVkdWNlciA9IGNvbWJpbmVSZWR1Y2Vycyh7XG4gICAgbG9nVXNlcixcbiAgICB1c2VyTm90aWZpY2F0aW9ucyxcbiAgfSk7XG4gIGNvbnN0IHN0b3JlID0gY3JlYXRlU3RvcmUocm9vdFJlZHVjZXIsIHJlZHV4U3RhdGUgfHwgaW5pdGlhbFN0YXRlKTtcbiAgcmV0dXJuIHJlbmRlcig8UHJvdmlkZXIgc3RvcmU9e3N0b3JlfT57dWl9PC9Qcm92aWRlcj4pO1xufVxuXG5qZXN0Lm1vY2soJ0FwaS9ub3RpZmljYXRpb25zLnNlcnZpY2UnLCAoKSA9PiAoe1xuICBzZXRTZWVuTm90aWZpY2F0aW9uczogamVzdC5mbigpLFxuICBnZXROb3RpZmljYXRpb25zOiBqZXN0LmZuKCksXG59KSk7XG5cbmRlc2NyaWJlKCdOb3RpZmljYXRpb24gTWVudSBFbXB0eScsICgpID0+IHtcbiAgdGVzdCgnSGFzIG5vdGlmaWNhdGlvbiBidXR0b24nLCAoKSA9PiB7XG4gICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8Tm90aWZpY2F0aW9uTWVudSAvPik7XG4gICAgZXhwZWN0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3R5LXN0YWNrJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ09wZW5zIERyb3Bkb3duJywgKCkgPT4ge1xuICAgIGNvbnN0IHsgZ2V0QnlUZXh0IH0gPSByZW5kZXJXaXRoUHJvdmlkZXJzKDxOb3RpZmljYXRpb25NZW51IC8+KTtcbiAgICBmaXJlRXZlbnQuY2xpY2soZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vdHktc3RhY2snKSk7XG4gICAgZXhwZWN0KGdldEJ5VGV4dCgnTm90aWZpY2FjaW9uZXMnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnTm8gbm90aWZpY2F0aW9ucycsICgpID0+IHtcbiAgICBjb25zdCB7IGdldEFsbEJ5VGV4dCB9ID0gcmVuZGVyV2l0aFByb3ZpZGVycyg8Tm90aWZpY2F0aW9uTWVudSAvPik7XG4gICAgZmlyZUV2ZW50LmNsaWNrKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3R5LXN0YWNrJykpO1xuICAgIGV4cGVjdChnZXRBbGxCeVRleHQoL05vIGhheSBub3RpZmljYWNpb25lcy9pKSkudG9IYXZlTGVuZ3RoKDIpO1xuICB9KTtcbn0pO1xuY29uc3Qgc3RhdGUgPSB7XG4gIGxvZ1VzZXI6IHtcbiAgICBkYXRhOiB7IGRvY3VtZW50TnVtYmVyOiAnMjMyMzIzJyB9LFxuICAgIGxvZ2dlZEluOiBmYWxzZSxcbiAgfSxcbiAgdXNlck5vdGlmaWNhdGlvbnM6IHtcbiAgICBub3RpZmljYXRpb25zOiBbXG4gICAgICB7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICB0aXRsZTogJ1VuYSBub3RpZmljYWNpb24nLFxuICAgICAgICBib2R5OiAnbm90aWZpY2FjaW9uJyxcbiAgICAgICAgc3RhdHVzOiAnbm90X3NlZW4nLFxuICAgICAgICBjcmVhdGVkQXQ6IGZha2VyLmRhdGUucGFzdCgpLFxuICAgICAgfSxcbiAgICBdLFxuICB9LFxufTtcbmRlc2NyaWJlKCdOb3RpZmljYXRpb24gTWVudSBPbmx5IE5ldycsICgpID0+IHtcbiAgdGVzdCgnTm8gc2VlbiBub3RpZmljYXRpb25zJywgKCkgPT4ge1xuICAgIGNvbnN0IHsgZ2V0QWxsQnlUZXh0IH0gPSByZW5kZXJXaXRoUHJvdmlkZXJzKDxOb3RpZmljYXRpb25NZW51IC8+LCBzdGF0ZSk7XG4gICAgZmlyZUV2ZW50LmNsaWNrKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3R5LXN0YWNrJykpO1xuICAgIGV4cGVjdChnZXRBbGxCeVRleHQoL05vIGhheSBub3RpZmljYWNpb25lcy9pKSkudG9IYXZlTGVuZ3RoKDEpO1xuICB9KTtcblxuICB0ZXN0KCdOZXcgbm90aWZpY2F0aW9ucycsICgpID0+IHtcbiAgICBjb25zdCB7IGdldEJ5VGV4dCB9ID0gcmVuZGVyV2l0aFByb3ZpZGVycyg8Tm90aWZpY2F0aW9uTWVudSAvPiwgc3RhdGUpO1xuICAgIGZpcmVFdmVudC5jbGljayhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm90eS1zdGFjaycpKTtcbiAgICBleHBlY3QoZ2V0QnlUZXh0KC9VbmEgbm90aWZpY2FjaW9uL2kpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICB9KTtcblxuICB0ZXN0KCdWaWV3IEhpc3RvcnknLCBhc3luYyAoKSA9PiB7XG4gICAgbm90aWZpY2F0aW9uc1NlcnZpY2UuZ2V0Tm90aWZpY2F0aW9ucy5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIHN0YXR1czogMjAwLFxuICAgICAgZGF0YToge1xuICAgICAgICBub3RpZmljYXRpb25zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaWQ6IDIsXG4gICAgICAgICAgICB0aXRsZTogJ0hpc3RvcmlhJyxcbiAgICAgICAgICAgIGJvZHk6ICdub3RpZmljYWNpb24nLFxuICAgICAgICAgICAgc3RhdHVzOiAnc2VlbicsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IERhdGVUaW1lLmxvY2FsKCkubWludXMoeyBkYXk6IDEgfSkudG9JU08oKSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9KSk7XG4gICAgY29uc3QgeyBnZXRCeVRleHQgfSA9IGF3YWl0IHJlbmRlcldpdGhQcm92aWRlcnMoPE5vdGlmaWNhdGlvbk1lbnUgLz4sIHN0YXRlKTtcbiAgICBmaXJlRXZlbnQuY2xpY2soZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vdHktc3RhY2snKSk7XG4gICAgZmlyZUV2ZW50LmNsaWNrKGdldEJ5VGV4dCgvVmVyIHRvZGFzL2kpKTtcbiAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgIGV4cGVjdChnZXRCeVRleHQoL0hpc3RvcmlhL2kpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdWaWV3IEhpc3RvcnkgQW5kIENsb3NlJywgYXN5bmMgKCkgPT4ge1xuICAgIG5vdGlmaWNhdGlvbnNTZXJ2aWNlLmdldE5vdGlmaWNhdGlvbnMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBzdGF0dXM6IDIwMCxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbm90aWZpY2F0aW9uczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlkOiAyLFxuICAgICAgICAgICAgdGl0bGU6ICdIaXN0b3JpYScsXG4gICAgICAgICAgICBib2R5OiAnbm90aWZpY2FjaW9uJyxcbiAgICAgICAgICAgIHN0YXR1czogJ3NlZW4nLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBEYXRlVGltZS5sb2NhbCgpLnRvSVNPKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgfSkpO1xuICAgIGNvbnN0IHsgZ2V0QnlUZXh0LCBxdWVyeUJ5VGV4dCB9ID0gYXdhaXQgcmVuZGVyV2l0aFByb3ZpZGVycyg8Tm90aWZpY2F0aW9uTWVudSAvPiwgc3RhdGUpO1xuICAgIGZpcmVFdmVudC5jbGljayhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm90eS1zdGFjaycpKTtcbiAgICBmaXJlRXZlbnQuY2xpY2soZ2V0QnlUZXh0KC9WZXIgdG9kYXMvaSkpO1xuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KGdldEJ5VGV4dCgvSGlzdG9yaWEvaSkpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG4gICAgZmlyZUV2ZW50LmNsaWNrKGdldEJ5VGV4dCgvRXNjb25kZXIvaSkpO1xuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KHF1ZXJ5QnlUZXh0KC9IaXN0b3JpYS9pKSkudG9CZU51bGwoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==